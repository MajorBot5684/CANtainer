[include ebb.cfg]
[include tmc5160.cfg]
[include cartographer.cfg]
[include mainsail.cfg]
[include macros.cfg]

# This file contains common pin mappings for the BigTreeTech Octopus
# Pro v1.1 board.

# Important! Do not use this config with an Octopus Pro v1.0 board nor
# non-Pro board.

# To use this config, during "make menuconfig", select "Enable
# low-level configuration options", select the STM32H723
# micro-controller, select a "128KiB bootloader", and select a "25Mhz
# crystal".

# See docs/Config_Reference.md for a description of parameters.

# Driver0
[stepper_x]
step_pin: PF13
dir_pin: !PF12
enable_pin: !PF14

microsteps: 64
rotation_distance: 40
full_steps_per_rotation: 200

endstop_pin: tmc5160_stepper_x:virtual_endstop
position_endstop: 400
position_max: 400
homing_speed: 50
homing_retract_dist: 60
min_home_dist: 40
use_sensorless_homing: true

# Driver1
[stepper_y]
step_pin: PG0
dir_pin: !PG1
enable_pin: !PF15

microsteps: 64
rotation_distance: 40
full_steps_per_rotation: 200

endstop_pin: tmc5160_stepper_y:virtual_endstop
homing_speed: 50
homing_retract_dist: 40
position_min: 0
position_max: 400
position_endstop: 400
use_sensorless_homing: true


# Driver2
[stepper_z]
step_pin: PF11
dir_pin: !PG3
enable_pin: !PG5
microsteps: 64
rotation_distance: 4
endstop_pin: probe:z_virtual_endstop
homing_retract_dist: 0
position_max: 400
position_min: -2
homing_speed: 10.0

# Driver3
# The Octopus only has 4 heater outputs which leaves an extra stepper
# This can be used for a second Z stepper, dual_carriage, extruder co-stepper,
# or other accesory such as an MMU
#[stepper_]
#step_pin: PG4
#dir_pin: PC1
#enable_pin: !PA2
#endstop_pin: PG11
#...

# Driver4
[stepper_z1]
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
microsteps: 64
rotation_distance: 4



#[filament_switch_sensor material_0]
#switch_pin: PG12

# Driver5
#[extruder1]
#step_pin: PC13
#dir_pin: PF0
#enable_pin: !PF1
#heater_pin: PA3 # HE1
#sensor_pin: PF5 # T1
#...

#[filament_switch_sensor material_1]
#switch_pin: PG13

# Driver6
#[extruder2]
#step_pin: PE2
#dir_pin: PE3
#enable_pin: !PD4
#heater_pin: PB0 # HE2
#sensor_pin: PF6 # T2
#...

#[filament_switch_sensor material_2]
#switch_pin: PG14

# Driver7
#[extruder3]
#step_pin: PE6
#dir_pin: PA14
#enable_pin: !PE0
#heater_pin: PB11 # HE3
#sensor_pin: PF7 # T3
#...

#[filament_switch_sensor material_3]
#switch_pin: PG15

[heater_bed]
heater_pin: PA0
sensor_pin: PF3 # TB
sensor_type: EPCOS 100K B57560G104F
control: pid
pid_Kp: 690.34
pid_Ki: 111.47
pid_Kd: 1068.83
min_temp: 0
max_temp: 130

#[fan]
#pin: PA8


[controller_fan controllerFan0]
pin: PA8
max_power: 1.0
fan_speed: 0.5
kick_start_time: 0
stepper: stepper_x

#[heater_fan fan1]
#pin: PE5

#[heater_fan fan2]
#pin: PD12

#[heater_fan fan3]
#pin: PD13

#[heater_fan fan4]
#pin: PD14

#[controller_fan fan5]
#pin: PD15

[mcu]
canbus_uuid: 732b9b6fd9fc

[temperature_sensor Octopus]
sensor_type: temperature_mcu
sensor_mcu: mcu

[printer]
kinematics: corexy
max_velocity: 800
max_accel: 5000
max_z_velocity: 10
max_z_accel: 80

[input_shaper]
shaper_freq_x: 59.8
shaper_type_x: ei
shaper_freq_y: 36.2
shaper_type_y: zv

[exclude_object]

########################################
# TMC2209 configuration
########################################

#[tmc2209 stepper_x]
#uart_pin: PC4
##diag_pin: PG6
#run_current: 0.800
#stealthchop_threshold: 999999

#[tmc2209 stepper_y]
#uart_pin: PD11
##diag_pin: PG9
#run_current: 0.800
#stealthchop_threshold: 999999

#[tmc2209 stepper_z]
#uart_pin: PC6
##diag_pin: PG10
#run_current: 0.650
#stealthchop_threshold: 999999

#[tmc2209 stepper_]
#uart_pin: PC7
##diag_pin: PG11
#run_current: 0.650
#stealthchop_threshold: 999999

#[tmc2209 extruder]
#uart_pin: PF2
#run_current: 0.800
#stealthchop_threshold: 999999

#[tmc2209 extruder1]
#uart_pin: PE4
#run_current: 0.800
#stealthchop_threshold: 999999

#[tmc2209 extruder2]
#uart_pin: PE1
#run_current: 0.800
#stealthchop_threshold: 999999

#[tmc2209 extruder3]
#uart_pin: PD3
#run_current: 0.800
#stealthchop_threshold: 999999

########################################
# TMC2130 configuration
########################################

#[tmc2130 stepper_x]
#cs_pin: PC4
#spi_bus: spi1
##diag1_pin: PG6
#run_current: 0.800
#stealthchop_threshold: 999999

#[tmc2130 stepper_y]
#cs_pin: PD11
#spi_bus: spi1
##diag1_pin: PG9
#run_current: 0.800
#stealthchop_threshold: 999999

#[tmc2130 stepper_z]
#cs_pin: PC6
#spi_bus: spi1
##diag1_pin: PG10
#run_current: 0.650
#stealthchop_threshold: 999999

#[tmc2130 stepper_]
#cs_pin: PC7
#spi_bus: spi1
##diag1_pin: PG11
#run_current: 0.800
#stealthchop_threshold: 999999

#[tmc2130 extruder]
#cs_pin: PF2
#spi_bus: spi1
#run_current: 0.800
#stealthchop_threshold: 999999

#[tmc2130 extruder1]
#cs_pin: PE4
#spi_bus: spi1
#run_current: 0.800
#stealthchop_threshold: 999999

#[tmc2130 extruder2]
#cs_pin: PE1
#spi_bus: spi1
#run_current: 0.800
#stealthchop_threshold: 999999

#[tmc2130 extruder3]
#cs_pin: PD3
#spi_bus: spi1
#run_current: 0.800
#stealthchop_threshold: 999999

#[board_pins]
#aliases:
    # EXP1 header
    #EXP1_1=PE8, EXP1_2=PE7,
    #EXP1_3=PE9, EXP1_4=PE10,
    #EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    #EXP1_7=PE14, EXP1_8=PE15,
    #EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    #EXP2_1=PA6, EXP2_2=PA5,
    #EXP2_3=PB1, EXP2_4=PA4,
    #EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    #EXP2_7=PC15, EXP2_8=<RST>,
    #EXP2_9=<GND>, EXP2_10=PC5

# See the sample-lcd.cfg file for definitions of common LCD displays.

# A [probe] section can be defined instead with a pin: setting identical
# to the sensor_pin: for a bltouch
#[bltouch]
#sensor_pin: PB7
#control_pin: PB6
#z_offset: 0

#[bed_mesh]
#speed: 400
#horizontal_move_z: 5
#mesh_min: 25, 25
#mesh_max: 300, 325
#probe_count: 5, 5
#mesh_pps: 3, 3
#algorithm: bicubic
#bicubic_tension: 0.2
#move_check_distance: 3
#split_delta_z: .025
#fade_start: 1
#fade_end: 10
#fade_target: 0


[z_tilt]
z_positions:
  372, 182.5
  -45, 182.5
points:
  50, 182.5
  100, 182.5
  180, 182.5
  250, 182.5
  350, 182.5
horizontal_move_z: 3
retries: 4
retry_tolerance: 0.16
speed: 600

[screws_tilt_adjust]
screw1: 63, 25
screw1_name: FL
screw2: 350, 25
screw2_name: FR
screw3: 350, 296
screw3_name: BR
screw4: 63,296 
screw4_name: BL
speed: 300
horizontal_move_z: 5
screw_thread: CW-M4


#[neopixel my_neopixel]
#pin: PB10
#[include moonraker_obico_macros.cfg]





[gcode_arcs]
resolution: 0.1

[force_move]
enable_force_move: true

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 3250
#*# scanner_touch_speed = 3
#*#
#*# [scanner model default]
#*# model_coef = 1.500735934106981,
#*# 	1.8351103703487346,
#*# 	0.7911133824980732,
#*# 	0.24255651377059648,
#*# 	0.1502875104917616,
#*# 	0.7612558946536779,
#*# 	0.14034168689112736,
#*# 	-0.8644190575222886,
#*# 	0.06808898406088632,
#*# 	0.4770672369658153
#*# model_domain = 3.17537432983151e-07,3.3047000674996116e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 25.501388
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -2.212424, -0.178800, -0.145170, -0.125404, -0.109977, -0.099979, -0.091853, -0.078461, -0.071049, -0.067470, -0.074072, -0.088594, -0.110450, -0.128722, -0.144087, -0.153068, -0.159294, -0.170103, -0.186101, -0.204625, -0.227203, -0.256250, -0.281515, -0.312810, -0.346336, -0.375886, -0.403817, -0.424651, -0.470016, -2.637585
#*# 	  -2.148372, -0.184262, -0.143007, -0.123677, -0.107351, -0.096053, -0.083512, -0.067765, -0.060855, -0.060948, -0.070420, -0.085445, -0.102528, -0.120525, -0.134497, -0.140636, -0.145692, -0.153796, -0.166766, -0.179955, -0.197541, -0.217989, -0.244922, -0.277862, -0.310938, -0.336656, -0.360776, -0.377049, -0.421473, -2.581157
#*# 	  -2.127324, -0.172930, -0.143720, -0.126897, -0.112517, -0.099545, -0.084123, -0.065058, -0.057771, -0.058944, -0.064751, -0.077568, -0.093558, -0.109429, -0.119044, -0.124721, -0.128629, -0.135101, -0.144537, -0.155221, -0.171430, -0.193526, -0.221435, -0.252703, -0.286932, -0.310052, -0.330971, -0.344056, -0.377600, -2.508474
#*# 	  -2.042505, -0.173391, -0.141503, -0.127568, -0.114124, -0.100550, -0.083197, -0.062320, -0.052909, -0.054367, -0.057919, -0.068699, -0.084434, -0.098087, -0.104118, -0.109843, -0.113436, -0.118454, -0.124902, -0.134098, -0.148910, -0.169612, -0.196753, -0.230135, -0.263657, -0.281962, -0.299926, -0.311773, -0.358791, -2.487389
#*# 	  -2.126363, -0.164149, -0.134155, -0.120041, -0.108248, -0.095714, -0.080221, -0.058997, -0.049090, -0.049382, -0.052174, -0.063549, -0.078677, -0.091219, -0.098364, -0.102301, -0.102141, -0.103784, -0.109574, -0.115997, -0.129288, -0.150571, -0.174098, -0.204587, -0.234448, -0.252901, -0.268672, -0.278875, -0.319738, -2.525479
#*# 	  -2.085824, -0.159335, -0.127674, -0.111041, -0.098405, -0.087968, -0.074378, -0.057301, -0.049648, -0.048756, -0.051221, -0.060795, -0.074301, -0.085318, -0.094513, -0.097947, -0.095369, -0.095063, -0.098485, -0.103003, -0.113139, -0.131625, -0.152789, -0.177331, -0.203843, -0.220141, -0.234297, -0.245165, -0.289633, -2.427934
#*# 	  -2.021459, -0.142078, -0.114857, -0.094936, -0.081527, -0.073891, -0.063985, -0.051973, -0.046724, -0.045611, -0.048435, -0.056788, -0.067720, -0.076898, -0.086263, -0.088636, -0.085849, -0.086968, -0.088965, -0.092362, -0.099230, -0.116680, -0.134051, -0.153624, -0.174645, -0.188456, -0.200280, -0.211654, -0.245894, -2.407171
#*# 	  -2.139411, -0.131647, -0.096558, -0.076463, -0.061711, -0.056578, -0.049732, -0.041531, -0.038801, -0.037082, -0.041000, -0.050340, -0.058857, -0.064928, -0.072270, -0.075007, -0.072676, -0.073741, -0.075681, -0.079414, -0.084943, -0.098245, -0.111252, -0.126200, -0.144106, -0.156058, -0.167794, -0.179983, -0.227847, -2.513702
#*# 	  -2.061506, -0.112325, -0.077966, -0.057351, -0.044716, -0.040713, -0.035970, -0.028923, -0.027646, -0.026615, -0.030568, -0.038376, -0.044432, -0.048785, -0.056287, -0.058938, -0.057280, -0.059395, -0.060025, -0.062683, -0.068285, -0.080220, -0.090117, -0.100520, -0.115496, -0.125904, -0.137549, -0.149173, -0.198220, -2.658614
#*# 	  -2.042890, -0.095072, -0.064055, -0.046496, -0.036165, -0.033277, -0.029769, -0.024250, -0.022802, -0.019747, -0.025724, -0.029715, -0.033486, -0.036756, -0.043023, -0.046996, -0.046932, -0.046015, -0.046118, -0.048534, -0.052974, -0.062692, -0.071093, -0.080789, -0.091847, -0.099188, -0.108991, -0.120991, -0.153505, -2.446904
#*# 	  -2.006332, -0.091767, -0.055796, -0.039821, -0.030686, -0.028714, -0.025338, -0.019548, -0.018766, -0.018829, -0.021403, -0.025028, -0.026607, -0.029533, -0.032541, -0.035088, -0.033664, -0.033818, -0.033203, -0.034919, -0.040061, -0.051044, -0.057109, -0.063944, -0.074806, -0.080843, -0.089638, -0.099847, -0.126809, -2.369110
#*# 	  -2.011507, -0.081259, -0.051800, -0.035769, -0.027350, -0.026383, -0.022617, -0.016345, -0.016291, -0.016023, -0.016964, -0.020061, -0.022496, -0.022552, -0.025769, -0.026329, -0.024921, -0.022945, -0.021487, -0.023069, -0.026647, -0.037474, -0.043462, -0.048371, -0.059074, -0.065465, -0.073640, -0.082801, -0.112805, -2.545318
#*# 	  -1.958536, -0.072108, -0.043168, -0.027989, -0.020689, -0.019170, -0.016875, -0.011070, -0.009541, -0.008277, -0.009251, -0.013316, -0.015185, -0.015133, -0.017099, -0.014372, -0.011631, -0.009983, -0.009391, -0.011118, -0.013937, -0.021293, -0.028084, -0.032663, -0.043485, -0.050632, -0.056562, -0.063962, -0.099895, -2.454579
#*# 	  -2.016230, -0.060477, -0.036776, -0.023955, -0.018199, -0.018086, -0.014220, -0.007612, -0.004892, -0.003177, -0.004341, -0.007574, -0.009686, -0.010661, -0.009868, -0.007521, -0.002274, -0.000254, -0.000221, -0.000760, -0.004000, -0.010147, -0.014942, -0.018870, -0.029781, -0.035806, -0.040944, -0.046273, -0.066439, -2.484942
#*# 	  -2.026412, -0.065556, -0.036807, -0.022831, -0.017883, -0.018151, -0.014831, -0.006395, -0.003097, -0.001224, -0.000224, -0.004089, -0.006124, -0.007273, -0.009243, -0.004342, 0.003458, 0.006483, 0.005422, 0.005893, 0.002680, -0.001524, -0.004947, -0.009941, -0.019116, -0.025265, -0.029314, -0.034211, -0.060612, -2.504175
#*# 	  -2.078165, -0.068594, -0.039214, -0.024425, -0.018055, -0.016482, -0.014173, -0.005058, -0.001870, 0.001639, 0.002428, -0.000896, -0.003861, -0.005166, -0.007785, -0.004177, 0.006486, 0.009930, 0.011682, 0.012037, 0.010707, 0.005954, 0.003208, -0.000064, -0.008043, -0.012498, -0.016909, -0.020242, -0.043977, -2.413340
#*# 	  -1.986593, -0.054805, -0.034309, -0.019900, -0.014152, -0.010019, -0.007920, 0.000842, 0.003966, 0.006033, 0.008684, 0.006221, 0.004117, 0.003056, 0.002722, 0.006593, 0.014302, 0.017464, 0.018897, 0.020397, 0.020323, 0.018509, 0.017809, 0.017008, 0.010852, 0.005674, 0.002223, -0.001437, -0.025037, -2.458701
#*# 	  -2.043313, -0.051298, -0.027893, -0.012894, -0.005751, -0.002562, 0.001119, 0.009618, 0.013782, 0.016690, 0.019049, 0.016267, 0.014264, 0.014099, 0.014962, 0.019503, 0.027111, 0.029298, 0.031646, 0.033850, 0.035528, 0.034906, 0.035728, 0.037239, 0.032547, 0.027329, 0.023792, 0.021442, -0.002106, -2.389511
#*# 	  -1.994842, -0.059974, -0.026554, -0.010660, -0.001230, 0.003223, 0.006320, 0.015658, 0.020240, 0.023732, 0.025475, 0.022978, 0.021418, 0.021971, 0.024179, 0.028454, 0.038102, 0.040271, 0.043020, 0.045728, 0.048182, 0.050300, 0.051635, 0.054066, 0.049461, 0.044824, 0.044000, 0.041774, 0.019425, -2.400096
#*# 	  -2.040279, -0.059868, -0.028471, -0.013561, -0.003040, 0.002281, 0.005999, 0.016360, 0.021215, 0.026024, 0.028411, 0.025371, 0.024230, 0.024874, 0.027972, 0.033118, 0.042603, 0.046302, 0.050677, 0.054738, 0.056458, 0.059370, 0.062064, 0.063443, 0.060000, 0.057489, 0.057825, 0.058232, 0.035923, -2.200108
#*# 	  -2.035480, -0.059843, -0.035107, -0.018450, -0.008081, -0.001801, 0.002241, 0.014553, 0.020094, 0.024782, 0.026620, 0.025058, 0.023157, 0.024180, 0.027288, 0.033280, 0.042530, 0.047486, 0.052396, 0.055839, 0.058913, 0.063233, 0.065877, 0.066462, 0.064261, 0.064886, 0.065788, 0.068755, 0.054024, -2.459597
#*# 	  -2.047153, -0.072650, -0.041940, -0.023972, -0.013599, -0.006084, 0.001200, 0.014764, 0.021287, 0.026120, 0.027680, 0.026021, 0.024796, 0.025498, 0.028514, 0.033505, 0.042189, 0.048691, 0.053012, 0.057731, 0.061896, 0.066427, 0.068835, 0.070484, 0.068776, 0.070400, 0.070942, 0.077721, 0.055208, -2.316605
#*# 	  -2.128463, -0.076742, -0.045506, -0.028484, -0.017027, -0.006883, 0.003051, 0.019031, 0.025769, 0.030450, 0.034227, 0.032457, 0.029995, 0.026803, 0.029723, 0.032741, 0.042819, 0.050486, 0.058551, 0.066029, 0.068595, 0.074459, 0.074869, 0.074971, 0.071569, 0.075053, 0.079237, 0.086565, 0.065887, -2.352106
#*# 	  -2.037796, -0.084332, -0.050434, -0.033505, -0.019072, -0.006122, 0.007358, 0.026784, 0.034183, 0.037866, 0.041735, 0.040452, 0.035736, 0.029443, 0.029748, 0.032885, 0.044326, 0.054970, 0.066397, 0.077430, 0.080769, 0.085480, 0.084794, 0.081492, 0.075984, 0.078476, 0.085979, 0.093838, 0.088686, -2.076940
#*# 	  -2.116003, -0.082318, -0.052454, -0.037302, -0.021553, -0.006283, 0.010984, 0.031213, 0.041829, 0.047845, 0.048950, 0.047176, 0.043452, 0.035002, 0.032110, 0.035061, 0.049385, 0.063372, 0.078852, 0.090011, 0.095989, 0.100529, 0.098406, 0.092227, 0.083603, 0.085528, 0.093206, 0.103336, 0.095652, -2.228849
#*# 	  -2.226028, -0.085282, -0.054255, -0.037246, -0.021669, -0.003216, 0.015898, 0.037118, 0.049460, 0.054401, 0.055769, 0.054310, 0.052378, 0.044914, 0.040883, 0.044740, 0.059093, 0.073404, 0.089787, 0.101443, 0.110517, 0.113949, 0.111750, 0.106353, 0.097691, 0.098119, 0.104200, 0.113116, 0.096604, -2.265104
#*# 	  -2.295853, -0.083411, -0.050051, -0.031158, -0.013642, 0.002350, 0.021003, 0.044240, 0.056631, 0.062797, 0.065464, 0.065150, 0.064297, 0.059283, 0.056139, 0.060081, 0.073573, 0.087086, 0.101814, 0.115223, 0.124309, 0.129638, 0.128715, 0.123523, 0.115495, 0.115132, 0.120719, 0.125613, 0.104251, -2.373348
#*# 	  -2.159178, -0.076842, -0.047120, -0.025252, -0.006781, 0.009513, 0.027804, 0.050260, 0.062245, 0.070357, 0.073370, 0.075621, 0.077444, 0.075247, 0.075905, 0.080885, 0.092454, 0.102783, 0.116601, 0.130610, 0.141525, 0.146140, 0.144680, 0.140622, 0.133476, 0.131911, 0.135522, 0.137733, 0.124897, -2.224826
#*# 	  -2.199212, -0.095744, -0.056646, -0.031499, -0.010294, 0.007400, 0.022849, 0.044050, 0.057574, 0.066548, 0.073963, 0.078881, 0.083841, 0.085877, 0.087739, 0.090277, 0.101277, 0.110968, 0.123992, 0.140530, 0.150009, 0.154333, 0.150605, 0.145820, 0.138991, 0.138234, 0.139301, 0.138585, 0.119214, -2.150093
#*# 	  -2.333468, -0.280655, -0.249625, -0.218720, -0.188848, -0.167300, -0.147965, -0.123146, -0.106872, -0.090717, -0.075664, -0.062667, -0.051906, -0.044458, -0.037957, -0.032344, -0.017766, -0.007236, 0.008090, 0.023172, 0.033832, 0.038532, 0.036705, 0.033664, 0.027649, 0.023282, 0.022532, 0.022784, 0.011821, -2.356780
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 385.0
#*# min_y = 35.0
#*# max_y = 380.0
